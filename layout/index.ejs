<%- include('widgets/appbar') %>
<%- include('widgets/sidebar') %>

<style>
.articles-container {
    margin: 0 auto;
    padding: 0 16px;
    column-count: 3;
}

.article-card {
    margin: 20px 0;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    cursor: pointer;
    border-radius: 16px;
    min-height: 110px;
    display: flex;
    align-items: center;
}

.article-card:hover {
    transform: translateY(-3px);
}

.article-content {
    padding: 1.25rem;
    width: 100%;
    justify-content: space-between;
    align-items: center;
}

.article-main {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.article-title {
    margin: 0;
    color: var(--mdui-color-on-surface);
    font-weight: 600;
    line-height: 1.3;
}

.article-meta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.article-date {
    color: var(--mdui-color-on-surface-variant);
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.article-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.article-side {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 1rem;
    margin-top: 20px;
}

.article-read-more {
    color: var(--mdui-color-primary);
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    white-space: nowrap;
}

.no-articles {
    text-align: center;
    padding: 3rem 2rem;
    border-radius: 16px;
    min-height: 200px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

@media (max-width: 1200px) {
    .articles-container {
        column-count: 2;
    }
}

@media (max-width: 500px) {
    .articles-container {
        column-count: 1;
    }
}
</style>

<mdui-layout-main>
    <div class="articles-container">
        <% if (site.posts.length > 0) { %>
            <% site.posts.forEach((post) => { %>
                <mdui-card 
                    class="article-card" 
                    variant="filled"
                    onclick="location.href='<%= url_for(post.path) %>'">
                    
                    <div class="article-content">
                        <!-- 左侧：标题和元信息 -->
                        <div class="article-main">
                            <mdui-typography variant="h4" class="article-title">
                                <%= post.title %>
                            </mdui-typography>

                            <span><%- truncate(strip_html(post.content), { length: 200 }) %></span>
                            
                            <div class="article-meta">
                                <mdui-typography variant="body2" class="article-date">
                                    <mdui-icon name="calendar_today" style="font-size: 1.1rem;"></mdui-icon>
                                    <%= post.date.format('YYYY-MM-DD') %>
                                </mdui-typography>
                                
                                <div class="article-tags">
                                    <% if (post.tags && post.tags.length > 0) { %>
                                        <% post.tags.data.slice(0, 2).forEach((tag) => { %>
                                            <mdui-chip 
                                                size="small" 
                                                variant="filled"
                                                style="background: var(--mdui-color-secondary-container); color: var(--mdui-color-on-secondary-container);">
                                                <mdui-icon name="sell" slot="icon" style="font-size: 1rem;"></mdui-icon>
                                                <%= tag.name %>
                                            </mdui-chip>
                                        <% }); %>
                                        <% if (post.tags.length > 2) { %>
                                            <mdui-chip 
                                                size="small" 
                                                variant="filled"
                                                style="background: var(--mdui-color-tertiary-container); color: var(--mdui-color-on-tertiary-container);">
                                                +<%= post.tags.length - 2 %>
                                            </mdui-chip>
                                        <% } %>
                                    <% } else if (post.categories && post.categories.length > 0) { %>
                                        <mdui-chip 
                                            size="small" 
                                            variant="filled"
                                            style="background: var(--mdui-color-primary-container); color: var(--mdui-color-on-primary-container);">
                                            <mdui-icon name="folder" slot="icon" style="font-size: 1rem;"></mdui-icon>
                                            <%= post.categories.data[0].name %>
                                        </mdui-chip>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 右侧：阅读更多 -->
                        <mdui-button class="article-side">
                            <mdui-icon name="arrow_forward" style="font-size: 1.2rem;"></mdui-icon>
                        </mdui-button>
                    </div>
                </mdui-card>
            <% }); %>
        <% } else { %>
            <mdui-card class="no-articles" variant="filled">
                <mdui-typography variant="h4" style="margin-bottom: 1rem; color: var(--mdui-color-on-surface);">
                    暂无文章
                </mdui-typography>
                <mdui-typography variant="body1" style="color: var(--mdui-color-on-surface-variant);">
                    还没有发布任何文章
                </mdui-typography>
            </mdui-card>
        <% } %>
    </div>
</mdui-layout-main>